<div class="chat-container">
    <!-- Header -->
    <mat-toolbar color="primary" class="chat-header">
      <span>Chat App</span>
      <div class="spacer"></div>
      <div *ngIf="user$ | async as user" class="user-info">
        <img *ngIf="user.photoURL" [src]="user.photoURL" alt="Avatar" class="avatar">
        <span>{{ user.displayName }}</span>
        <button mat-icon-button (click)="signOut()">
          <mat-icon>logout</mat-icon>
        </button>
      </div>
    </mat-toolbar>
  
    <!-- Messages -->
    <div class="messages-container" #messagesContainer>
      <div *ngFor="let message of messages$ | async" 
           class="message-wrapper"
           [class.my-message]="isMyMessage(message)">
        
        <div class="message-bubble" [class.my-bubble]="isMyMessage(message)">
          <div class="message-header" *ngIf="!isMyMessage(message)">
            <img *ngIf="message.userPhoto" [src]="message.userPhoto" alt="Avatar" class="message-avatar">
            <span class="username">{{ message.userName }}</span>
          </div>
          
          <div class="message-text">{{ message.text }}</div>
          
          <div class="message-time">
            {{ message.timestamp?.toDate ? (message.timestamp.toDate() | date:'short') : (message.timestamp | date:'short') }}
          </div>
        </div>
      </div>
    </div>
  
    <!-- Message Input -->
    <div class="message-input-container">
      <mat-form-field appearance="outline" class="message-input">
        <textarea 
          matInput 
          [formControl]="messageControl"
          placeholder="Type a message..."
          (keydown)="onKeyPress($event)"
          rows="1"
          cdkTextareaAutosize
          cdkAutosizeMinRows="1"
          cdkAutosizeMaxRows="4"></textarea>
      </mat-form-field>
      
      <button 
        mat-fab 
        color="primary" 
        class="send-button"
        (click)="sendMessage()"
        [disabled]="!messageControl.value?.trim()">
        <mat-icon>send</mat-icon>
      </button>
    </div>
  </div>
  